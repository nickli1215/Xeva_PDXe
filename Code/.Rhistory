Sys.which("make")
install.packages("jsonlite", type = "source")
.libPaths()
setwd("C:/Users/nicho/Documents/UHN/Xeva_PDXe/Code")
library(PharmacoGx)
library(umap)
library(ggplot)
library(tidyverse)
library(reshape)
library(tidyr)
library(genefu)
library(sva)
Morag.data<-readRDS("../Data/Morag/pdx_68_samples_rnaseq_gene_count.rda")
Morag.assay<-Morag.data$data
Morag.assay<-Morag.assay[rowVars(assay(Morag.assay),na.rm=TRUE)!=0,]
Morag.counts<-assay(Morag.assay)*1e6
CCLE.breast<-readRDS("../Data/CCLE/CCLE_breast.rds")
CCLE.experiment<-summarizeMolecularProfiles(CCLE.breast,"Kallisto_0.46.1.rnaseq.counts")
CCLE.cell<-colData(CCLE.experiment)
CCLE.geneinfo<-rowData(CCLE.experiment)
cells<-colSums(is.na(assay(CCLE.experiment)))==0
CCLE.experiment<-CCLE.experiment[rowVars(assay(CCLE.experiment),na.rm=TRUE)!=0,cells]
CCLE.counts<-2**assay(CCLE.experiment) - 1
Cescon.assay<-readRDS("../Data/Cescon/gene_count.rds")
Cescon.counts<-assay(Cescon.assay)*1e6
Cescon.counts<-Cescon.counts[rowVars(Cescon.counts,na.rm=TRUE)!=0,]
TCGA.counts<-read.table("../Data/TCGA/TCGA-BRCA.htseq_counts.tsv",sep='\t',header=TRUE,row.names=1)
TCGA.counts<-2**TCGA.counts[rowVars(as.matrix(TCGA.counts))>0,]-1
TCGA.subtypes<-readRDS("../Data/TCGA/subtypeinfo.rds")
TCGA.subtypes<-TCGA.subtypes$subtype
gene_subset<-intersect(rownames(CCLE.counts),rownames(Morag.counts))
gene_subset<-intersect(gene_subset,rownames(TCGA.counts))
gene_subset<-intersect(gene_subset,rownames(Cescon.counts))
Morag.rnaseq<-readRDS("../Data/Morag/pdxMorag_rnaseq.rda")
Morag.pdata<-pData(Morag.rnaseq)
Morag.tumours<-rownames(Morag.pdata[Morag.pdata$Source=="Patient",])
Morag.tumours<-Morag.tumours[-22]
Morag.PDXs<-rownames(Morag.pdata[Morag.pdata$Source=="PDX",])
Morag.PDXs<-Morag.PDXs[-28]
Morag.PDX.assay<-Morag.assay[,Morag.PDXs]
Morag.Tumour.assay<-Morag.assay[,Morag.tumours]
Morag.Tumour.assay<-Morag.Tumour.assay[gene_subset,]
Morag.PDX.assay<-Morag.PDX.assay[gene_subset,]
TCGA.counts<-TCGA.counts[gene_subset,]
Cescon.counts<-Cescon.counts[gene_subset,]
CCLE.counts<-CCLE.counts[gene_subset,]
all.exprs<-cbind(assay(Morag.Tumour.assay),
assay(Morag.PDX.assay),
TCGA.counts,
Cescon.counts,
CCLE.counts)
batch <- c(rep("Morag", ncol(assay(Morag.Tumour.assay))),
rep("Morag", ncol(assay(Morag.PDX.assay))),
rep("TCGA",ncol(TCGA.counts)),
rep("Cescon",ncol(Cescon.counts)),
rep("CCLE",ncol(CCLE.counts)))
gene_lengths<-fData(Morag.rnaseq)[gene_subset,"end"] - fData(Morag.rnaseq)[gene_subset,"start"]
sample.dataset<-c(rep("Morag Tumour", ncol(assay(Morag.Tumour.assay))),
rep("Morag PDX", ncol(assay(Morag.PDX.assay))),
rep("TCGA",ncol(TCGA.counts)),
rep("Cescon",ncol(Cescon.counts)),
rep("CCLE",ncol(CCLE.counts)))
adjusted_counts.FPKM<-readRDS("../Data/Combined_batchCorrected_FPKM.rds")
dataset.umap<-umap(t(adjusted_counts.FPKM))
dataset.umap.df<-dataset.umap$layout
dataset.umap$layout
dataset.umap.df<-dataset.umap$layout
dataset.umap.df$batch <-batch
dataset.umap.df$dataset<-sample.dataset
colnames(dataset.umap.df)
dataset.umap.df
dataset.umap<-umap(t(adjusted_counts.FPKM))
dataset.umap.df<-data.frame(dataset.umap$layout)
dataset.umap.df$batch <-batch
dataset.umap.df$dataset<-sample.dataset
colnames(dataset.umap.df)
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=dataset)) +
geom_point() + geom_rug()
library(ggplot2)
dataset.umap.df<-data.frame(dataset.umap$layout)
dataset.umap.df$batch <-batch
dataset.umap.df$dataset<-sample.dataset
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=dataset)) +
geom_point() + geom_rug()
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=dataset)) +
geom_point()
?;pdf
?pdf
pdf("../Results/Adjusted_Scatterplot.PDF",width=8,height=8)
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=dataset)) +
geom_point()
dev.off()
?hclust()
cor(adjusted_counts.FPKM,method="spearman")
corrs<-cor(adjusted_counts.FPKM,method="spearman")
corrs
dim(corrs)
hclust(corrs)
is.na(corrs)
sum(is.na(corrs))
?dist
as.simil(corrs)
as.dist((1-corrs)/2)
hclust(as.dist((1-corrs)/2))
hclust(as.dist((1-corrs)/2))
full.cluster<-hclust(as.dist((1-corrs)/2))
heatmap(corrs)
Heatmap(corrs)
library(ComplexHeatmap)
Heatmap(corrs)
Heatmap(corrs,show_row_names = FALSE,show_column_names = FALSE,show_column_dend = FALSE)
full.cluster
full.cluster$labels
plot(full.cluster)
cutree(full.cluster,k=3)
cutree(full.cluster,k=5)
dataset.umap.df$cluster<-cutree(full.cluster,k=5)
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=cluster)) +
geom_point()
as.factor(cutree(full.cluster,k=5))
dataset.umap.df$cluster<-as.factor(cutree(full.cluster,k=5))
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=cluster)) +
geom_point()
ggplot(dataset.umap.df, aes(x=X1, y=X2, color=dataset,shape=cluster)) +
geom_point()
