setwd('G:/UHN/Xeva_PDXe/Code')
library(Biobase)
PDX_exprs<-readRDS('../Data/PDXE_microArray.rds')
exprs_data<-exprs(PDX_exprs)
metadata<-pData(PDX_exprs)
#biobase.id, patient.id, passage, tumor.type
#Each passage is basically a new PDX, 0th is direct sample
#Subset and remove patients that have only 1 passage/sample
#Subset only to breast cancer
#natural log
metadata
rownames(exprs_data)
colnames(exprs_data)
metadata
exprs_data
?PDX_exprs
class(PDX_exprs)
?ExpressionSet
install.packages("remotes")
remotes::install_github("icbi-lab/immunedeconv")
warnings()
rm(list=ls())
remotes::install_github("icbi-lab/immunedeconv")
warnings()
library(immunedconv)
remotes::install_github("icbi-lab/immunedeconv")
remotes::install_github("icbi-lab/immunedeconv",force=TRUE)
library(immunedeconv)
set_cibersort_binary("G:/UHN/CIBERSORT/CIBERSORT.R")
set_cibersort_mat("G:/UHN/CIBERSORT/LM22.txt")
PDX_exprs
PDX_exprs<-readRDS('../Data/PDXE_microArray.rds')
PDX_exprs
exprs_data<-exprs(PDX_exprs)
deconvolution<-deconvolute(exprs_data,"quantiseq")
exprs_data
exp(10)
exp(exprs_data)
exprs_data.not_log<-exp(exprs_data)
deconvolution<-deconvolute(exprs_data.not_log,"quantiseq")
breast_pdxs<-metadata[metadata$tumor.type=="breast",]$biobase.id
exprs_data<-exprs(PDX_exprs)[,breast_pdxs]
PDX_exprs<-readRDS('../Data/PDXE_microArray.rds')
metadata<-pData(PDX_exprs)
breast_pdxs<-metadata[metadata$tumor.type=="breast",]$biobase.id
exprs_data<-exprs(PDX_exprs)[,breast_pdxs]
exprs_data.not_log<-exp(exprs_data)
deconvolution<-deconvolute(exprs_data.not_log,"cibersort")
deconvolution
metadata
breast_metadata<-metadata[breast_pdxs,]
breast_metadata
library(GGally)
install.packages("GGally")
data
iris
deconvolution
t(metadata)
starwars
library(dplyr)
rbind(breast_metadata,deconvolution)
colnames(deconvolution)
deconvolution[,-1]
rbind(t(breast_metadata)[,breast_pdxs],deconvolution[,-1][,breast_pdxs])
c(colnames(breast_metadata),deconvolution[,1])
c(unlist(colnames(breast_metadata)),unlist(deconvolution[,1]))
c(unlist(colnames(breast_metadata)),deconvolution$cell_type)
breast_pdx_deconvolution<-rbind(t(breast_metadata)[,breast_pdxs],deconvolution[,-1][,breast_pdxs])
breast_pdx_deconvolution
rownames(breast_pdx_deconvolution)<-c(unlist(colnames(breast_metadata)),deconvolution$cell_type)
breast_pdx_deconvolution
breast_pdx_deconvolution.df<-as.dataframe(breast_pdx_deconvolution)
library(dplyr)
breast_pdx_deconvolution.df<-as.dataframe(breast_pdx_deconvolution)
library(tidyr)
breast_pdx_deconvolution.df<-as.dataframe(breast_pdx_deconvolution)
breast_pdx_deconvolution.df<-as.data.frame(breast_pdx_deconvolution)
View(breast_pdx_deconvolution.df)
breast_pdx_deconvolution.df<-t(as.data.frame(breast_pdx_deconvolution))
View(breast_pdx_deconvolution.df)
iris
breast_pdx_deconvolution.df<-t(as.data.frame(breast_pdx_deconvolution))
iris
breast_pdx_deconvolution.df
factor(breast_pdx_deconvolution.df$patient.id)
breast_pdx_deconvolution.df<-as.data.frame(t(breast_pdx_deconvolution))
View(breast_pdx_deconvolution.df)
factor(breast_pdx_deconvolution.df$patient.id)
gather(breast_pdx_deconvolution.df$patient.id)
breast_pdx_deconvolution
breast_pdx_deconvolution.df
breast_pdx_deconvolution.df
melt(breast_pdx_devoncolution.df)
library(reshape2)
melt(breast_pdx_deconvolution.df)
melt.data.frame(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"))
melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"))
breast_pdx_deconvolution
breast_pdx_deconvolution[-c(1,4)]
breast_pdx_deconvolution[-c(1,4),]
breast_pdx_deconvolution.df<-as.data.frame(t(breast_pdx_deconvolution[-c(1,4),]))
melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"))
melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage",variable.name="Cell Type",value.name="Proportion")
)
melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="Cell Type",value.name="Proportion")
]\
melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="Cell Type",value.name="Proportion")
breast_pdx_deconvolution.df<-melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="Cell Type",value.name="Proportion")
View(breast_pdx_deconvolution.df)
length(unique(breast_pdx_deconvolution.df$`Cell Type`))
table(breast_pdx_deconvolution.df$patient.id)
breast_pdx_deconvolution.df<-as.data.frame(t(breast_pdx_deconvolution[-c(1,4),]))
table(breast_pdx_deconvolution.df$patient.id)
table(breast_pdx_deconvolution.df$patient.id)==1
table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)==1]
colnames(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)==1])
colnames(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)==1,])
names(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)==1,])
names(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)==1])
breast_pdx_deconvolution.df<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$patient.id %in% multiple.samples,]
multiple.samples<-names(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)>1])
breast_pdx_deconvolution.df<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$patient.id %in% multiple.samples,]
breast_pdx_deconvolution.df<-melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="Cell Type",value.name="Proportion")
table(breast_pdx_deconvolution.df$patient.id)
breast_pdx_deconvolution.df
reshape(breast_pdx_deconvolution.df, idvar = "patient.id", timevar = "passage", direction = "wide")
breast_pdx_deconvolution.df
dcast(breast_pdx_deconvolution.df, patient.id+`Cell Type` ~ passage)
breast_pdx_deconvolution.df<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$patient.id %in% multiple.samples,]
breast_pdx_deconvolution.df<-melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="Cell.Type",value.name="Proportion")
dcast(breast_pdx_deconvolution.df, patient.id+`Cell Type` ~ passage,value.var="Proportion")
metadata<-pData(PDX_exprs)
breast_pdxs<-metadata[metadata$tumor.type=="breast",]$biobase.id
exprs_data<-exprs(PDX_exprs)[,breast_pdxs]
exprs_data.not_log<-exp(exprs_data)
deconvolution<-deconvolute(exprs_data.not_log,"cibersort")
breast_metadata<-metadata[breast_pdxs,]
breast_pdx_deconvolution<-rbind(t(breast_metadata)[,breast_pdxs],deconvolution[,-1][,breast_pdxs])
rownames(breast_pdx_deconvolution)<-c(unlist(colnames(breast_metadata)),deconvolution$cell_type)
breast_pdx_deconvolution.df<-as.data.frame(t(breast_pdx_deconvolution[-c(1,4),]))
multiple.samples<-names(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)>1])
breast_pdx_deconvolution.df<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$patient.id %in% multiple.samples,]
breast_pdx_deconvolution.df<-melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="cell.type",value.name="Proportion")
breast_metadata<-metadata[breast_pdxs,]
breast_pdx_deconvolution<-rbind(t(breast_metadata)[,breast_pdxs],deconvolution[,-1][,breast_pdxs])
rownames(breast_pdx_deconvolution)<-c(unlist(colnames(breast_metadata)),deconvolution$cell_type)
breast_pdx_deconvolution.df<-as.data.frame(t(breast_pdx_deconvolution[-c(1,4),]))
multiple.samples<-names(table(breast_pdx_deconvolution.df$patient.id)[table(breast_pdx_deconvolution.df$patient.id)>1])
breast_pdx_deconvolution.df<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$patient.id %in% multiple.samples,]
breast_pdx_deconvolution.df<-melt(breast_pdx_deconvolution.df,id.vars=c("patient.id","passage"),variable.name="cell.type",value.name="Proportion")
dcast(breast_pdx_deconvolution.df, patient.id+Cell.Type ~ passage,value.var="Proportion")
dcast(breast_pdx_deconvolution.df, patient.id+cell.type ~ passage,value.var="Proportion")
breast_pdx_deconvolution.df
breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$cell.type==cell_type,]
cell_type <-"B cell naive"
breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$cell.type==cell_type,]
ggparcoord(bcell_data,
columns = c(1,4), groupColumn = 2
)
library(GGally)
ggparcoord(breast_pdx_deconvolution.df,
columns = 1:4, groupColumn = 5
)
ggparcoord(bcell_data,
columns = c(1,4), groupColumn = 2
)
cell_type <-"B cell naive"
bcell_data<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$cell.type==cell_type,]
ggparcoord(bcell_data,
columns = c(1,4), groupColumn = 2
)
ggparcoord(bcell_data,
columns = c(1,2,4)
)
bcell_data
dcast(bcell_data[,c(1,2,4)],passage ~ proportion)
dcast(bcell_data[,c(1,2,4)],passage ~ Proportion)
\
dcast(bcell_data[,c(1,2,4)],passage ~ Proportion)
dcast(bcell_data[,c(1,2,4)],patient.id ~ passage)
dcast(bcell_data[,c(1,2,4)],patient.id ~ passage,fun.aggregate=mean())
reshape(bcell_data[,c(1,2,4)], idvar = "patient.id", timevar = "passage", direction = "wide")
reshape(bcell_data[,c(1,2,4)], idvar = "patient.id", timevar = "Proportion", direction = "wide")
reshape(bcell_data[,c(1,2,4)], idvar = "patient.id", timevar = "passage", direction = "wide")
bcell_data<-reshape(bcell_data[,c(1,2,4)], idvar = "patient.id", timevar = "passage", direction = "wide")
ggparcoord(bcell_data)
bcell_dawta
bcell_data
ggparcoord(bcell_data,
columns = 1:7
)
ggparcoord(bcell_data,
columns = 1:7,missing='exclude'
)
ggparcoord(bcell_data,
columns = 2:7,missing='exclude'
)
bcell_data
bcell_data<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$cell.type==cell_type,]
bcell_data
reshape(bcell_data[,c(1,2,4)], idvar = "patient.id", timevar = "passage", direction = "wide")
dcast(bcell_data[,c(1,2,4)],patient.id ~ passage,mean)
dcast(bcell_data[,c(1,2,4)],patient.id ~ passage,function(x) mean(na.omit(x)))
warnings()
dcast(bcell_data[,c(1,2,4)],patient.id ~ passage,function(x) mean(na.omit(as.numeric(x))))
bcell_data<-breast_pdx_deconvolution.df[breast_pdx_deconvolution.df$cell.type==cell_type,]
bcell_data<-dcast(bcell_data[,c(1,2,4)],patient.id ~ passage,function(x) mean(na.omit(as.numeric(x))))
bcell_data
ggparcoord(bcell_data,
columns = 2:7,missing='exclude'
)
ggparcoord(bcell_data[-1],
columns = 2:7,missing='exclude'
) \
ggparcoord(bcell_data[-1],
columns = 2:7,missing='exclude'
)
bcell_data[-1],
ggparcoord(bcell_data[-1],
columns = 2:6,missing='exclude'
)
tibble(bcell_data[-1])
ggparcoord(tibble(bcell_data[-1]),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6,missing='exclude'
)
ggparcoord(tibble(bcell_data),
columns = 2:6
)
tibble(bcell_data)
dcast(breast_pdx_deconvolution.df[,c(1,2,4)],patient.id ~ passage,function(x) mean(na.omit(as.numeric(x))))
dcast(breast_pdx_deconvolution.df,patient.id+cell.type ~ passage,function(x) mean(na.omit(as.numeric(x))))
plotting.df<-dcast(breast_pdx_deconvolution.df,patient.id+cell.type ~ passage,function(x) mean(na.omit(as.numeric(x))))
plotting.df
ggparcoord(plotting.df,
columns = 3:7
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
rownames(plotting.df)
plotting.df
typeof(plotting.df)
class(plotting.df)
as.numeric(plotting.df)
typeof(plotting.df$`2`k)
typeof(plotting.df$`2`)
typeof(plotting.df$patient.id)
typeof(plotting.df$cell.type)
as.character(plotting.df$cell.type)
plotting.df[,"cell.type"]<-as.character(plotting.df$cell.type)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
as.data.frame(plotting.df)
plotting.df<-dcast(breast_pdx_deconvolution.df,patient.id+cell.type ~ passage,function(x) mean(na.omit(as.numeric(x))))
plotting.df[,"cell.type"]<-as.character(plotting.df$cell.type)
rownames(plotting.df)<-plotting.df$patient.id
ggparcoord(plotting.df,
columns = 3:7,groupColumn=2
)
ggparcoord(plotting.df[,-1],
columns = 2:6,groupColumn=1
)
